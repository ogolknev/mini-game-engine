# Документация

## Содержание

- [Документация](#документация)
  - [Содержание](#содержание)
  - [`main`](#main)
  - [`init`](#init)
  - [`data/`](#data)
    - [`data/settings`](#datasettings)
  - [`objects`](#objects)
    - [`objects.behavior`](#objectsbehavior)
      - [`objects.behavior.controllers`](#objectsbehaviorcontrollers)
      - [`objects.behavior.movement`](#objectsbehaviormovement)
    - [`objects.sprites`](#objectssprites)
  - [`static/`](#static)
    - [`static/textures/`](#statictextures)
      - [`static/textures/spritesheets/`](#statictexturesspritesheets)
  - [`tools`](#tools)
    - [`tools.load_tools`](#toolsload_tools)
    - [`tools.math_tools`](#toolsmath_tools)

## `main`

Исполняемый файл содержащий основной цикл программы. Через него осуществляется запуск приложения.

```python
import ...

while run:
  # основной цикл
```

## `init`

Инициализация всех основных сущностей.

## `data/`

Каталог содержащий данные приложения.

### `data/settings`

Основные настройки приложения.

```json5
{
    "window": // настройки окна приложения
    {
        "caption": "demo 0.0", // загаловок окна
        "resolution": [512,512], // разрешение окна
        "fullscreen": 0, // полноэкранный режим
        "fps": 0 // ограничение fps (0 - без ограничений)
    },
    "key_controls": // назначение клавиш
    {
        "move_up": 119, // движение вверх
        "move_left": 97, // движение влево
        "move_down": 115, // движение вниз
        "move_right": 100, // движение вправо

        "fullscreen": 1073741892, // переключение полноэкранного режима

        "exit": 27, // выход из приложения

        "scale_up": 61, // приближение камеры
        "scale_down": 45 // отдаление камеры
    }
}
```

## `objects`

Пакет модулей описывающих объекты внутри приложения.

### `objects.behavior`

Пакет модулей описывающих поведение объектов внутри приложения.

#### `objects.behavior.controllers`

Модуль описывающий контроллеры - функции управляющие другими объектами.

**`objects.behavior.controllers.appKeyController()`** - контроллер управляющий основными настройками приложения с помощью клавиатуры.

Принимает:
- `pressed_keys` - объект pygame (pygame.key.ScancodeWrapper), содержащий состояние всех клавиш
- `settings` - словарь содержащий настройки приложения
- `run` - переключатель отвечающий за работу приложения
- `scale` - коэффициент приближения камеры
- `clock` - объект pygame для отслеживания времени

Возвращает:
- `settings` - обработанный словарь содержащий настройки приложения
- `run` - обработанный переключатель отвечающий за работу приложения
- `scale` - обработанный коэффициент приближения камеры

```python
def appKeyController(
    pressed_keys: ScancodeWrapper,
    settings: dict,
    run: bool,
    scale: float,
    clock: Clock
) -> tuple[dict, bool, float]
```

**`objects.behavior.controllers.gameKeyController()`** - контроллер управляющий движением сущностей внутри приложения с помощью клавиатуры.
Определяет направление движения сущности, в соответсвии нажатым клавишам.

Принимает:
- `kwargs` - кей-ворд параметры:
    - `settings` - словарь содержащий настройки приложения
    - `pressed_keys` - объект pygame (pygame.key.ScancodeWrapper), содержащий состояние всех клавиш

Возвращает:
- `move_direction` - список из двух направлений [по горизонтали, по вертикали]
(`1` - в сторону увеличения координаты, `-1` - наоборот, 0 - нет движения)

```python
def gameKeyController(**kwargs: Any) -> list[int]
```

**`objects.behavior.controllers.gameRandController()`** - контроллер управляющий движением сущностей внутри приложения.
Случайно определяет направление движения сущности.

Принимает:
- `kwargs` - кей-ворд параметры:
    - `sprite` - сущность для которой определяется направление движения

Возвращает:
- `move_direction` - список из двух направлений [по горизонтали, по вертикали]
(`1` - в сторону увеличения координаты, `-1` - наоборот, 0 - нет движения)

```python
def gameRandController(**kwargs: Any) -> Any
```

#### `objects.behavior.movement`

Модуль содержит функции описывающие движение объектов.

**`objects.behavior.movement.calculatePath()`** - расчитывает путь объекта, который он попытается пройти за 1 кадр и обновляет атрибут `sprite.path`.
Расчитывает скорость в начале текущего кадра и обновляет `sprite.speed`. Вызывает метод анимации спрайта.

Принимает:
- `sprite` - объект для которого выполняются расчеты и вызывается метод анимации
- `kwargs` - кей-ворд параметры передаваемые контроллеру объекта

Возвращает:
- `sprite.path` - путь объекта, который он попытается пройти за 1 кадр

```python
def calculatePath(
    sprite: Sprite,
    **kwargs: Any
) -> list
```

**`objects.behavior.movement.calculateEntitiesPaths()`** - вычисляет путь для каждой сущности из группы. Возвращает список всех компонентов (горизонатльный/вертикальный путь) всех вычесленных путей.

Принимает:
- `moving_entities` - группа сущностей для которых вычисляются пути (смещения между текущим и следующим кадром)
- `kwargs` - дополнительные параметры нужные для calculatePath()

Возвращает:
- `paths` - список всех компонентов (горизонатльный/вертикальный путь) всех вычесленных путей

```python
def calculateEntitiesPaths(
    moving_entities: Group,
    **kwargs: Any
) -> list
```

**`objects.behavior.movement.standartMovement()`** - основная функция реализующая движение объектов через их контроллеры и максимальную скорость/ускорение.

Суть текущей реализации: Вычисляются пути всех объектов. Они делятся на одинаковое колличество шагов такое,
что максимальный шаг объекта был не больше 1 пикселя (при scale=1.0). Потом путь проходится всеми объектами пошагово,
проверяя столкновения на каждом шаге.

Принимает:
- `entities` - группа (pygame.sprite.Group) объектов для которой реализуется движение
- `moving_entities` - группа (pygame.sprite.Group) объектов способных двигаться
- `kwargs` - кей-ворд параметры для calculateEntitiesPaths()

```python
def standartMovement(
    entities: Group,
    moving_entities: Group,
    **kwargs: Any
) -> None
```

**`objects.behavior.movement.collideHandle()`** - определяет направления заблокированные для движения `move_block`. Обновляет `sprite.move_block`.
Перед использованием заблокированные направления должны быть сброшены (`move_block` = [0,0]).

Принимает:
- `sprite` - объект для которого определяются блокировки
- `collisions` - список объектов с которыми он столкнулся

```python
def collideHandle(
    sprite: Sprite,
    collisions: Any
) -> None
```

### `objects.sprites`

**`objects.sprites.Group`** - cтанадртный класс `pygame.sprite.Group` с измененными методами:
- `draw` - в нем реализованны функции `observer` (закрепление камеры за объектом) и `scale` (приближение и отдаление камеры)
- `update` - в нем реализованна функция передвижения объектов группы

Атрибуты:
- стандартные атрибуты `pygame.sprite.Group`

**`objects.sprites.Group.draw()`** - отрисовывает объекты группы на переданной поверхности, в пределах области отрисовки (102% разрешения окна)

Параметры:
- `surface` - поверхность на которой происходит отрисовка
- `resolution` - разрешение главного окна
- `observer` - объект за которым закреплена камера
- `scale` - коэффициент приближения камеры

```python
def draw(
    self: Self@Group,
    surface: Surface,
    resolution: Any,
    observer: Any,
    scale: Any
) -> None
```

**`objects.sprites.Group.update()`** - обновляет свойства объектов между кадрами в соответсвии с описанным поведением в методе `update()` элементов группы и функцией движения.

Параметры:
- параметры необходимые методам `update()` объектов группы и функции движения

```python
def update(
    self: Self@Group,
    moving_entities: Group,
    *args: Any,
    **kwargs: Any
) -> None
```

**`objects.sprites.Sprite`** - класс описывающий все объекты в главном окне. 

Атрибуты:
- `image` - текстура объекта отображаемая на экране
- `spritesheet` - словарь содержащий все кадры анимации объекта
- `_animation_frame_index` - индекс кадра анимации
- `rect` - хитбокс объекта
- `hitbox_position` - положение хитбокса внутри текстуры объекта
- `float_position` - позиция объекта на экране не привязанная к сетке пикселей
- `_clock` - экземпляр класса `pygame.time.Clock` позволяющий импользовать в методах время которое прошло с последнего кадра

**`objects.sprites.Sprite.update()`** - обновляет свойства объекта между кадрами. Абстрактный метод.

**`objects.sprites.Entity`** - класс описывающий объекты внутри игры.

Атрибуты:
- `image` - текстура объекта отображаемая на экране
- `spritesheet` - словарь содержащий все кадры анимации объекта
- `_animation_frame_index` - индекс кадра анимации
- `rect` - хитбокс объекта
- `hitbox_position` - положение хитбокса внутри текстуры объекта
- `float_position` - позиция объекта на экране не привязанная к сетке пикселей
- `_clock` - экземпляр класса `pygame.time.Clock` позволяющий импользовать в методах
время которое прошло с последнего кадра
- `controller` - функция определяющая направление движения объекта
- `speed` - текущая скорость объекта в виде списка из двух значений: скрость по горизонтали и скрость по вертикали
- `path` - путь объекта за текущий кадр в виде списка из двух значений: путь по горизонтали и путь по вертикали
- `move_block` - блокировки направлений движения объекта в виде списка из двух значений:
блокировки по горизонтали и блокировки по вертикали 
- `kwattrs` - key-word атрибуты которые используются методами класса и группами которым принадлежит объект

**`objects.sprites.Entity.update()`** - обновляет свойства объекта между кадрами. Пока пуст.

**`objects.sprites.Entity.animation()`** - cменяет кадры в анимации сущности.

  Параметры:
  - `mode` - название типа анимации в `self.spritesheet`
  - `args` - ключи по которым определяется конкретный набор кадров в `self.spritesheet`
  - `speed` - скорость (кадры/секунду) анимации

```python
def animation(
    self: Self@Entity,
    speed: Any,
    mode: Any,
    *args: Any
) -> None
```

## `static/`

Каталог статических файлов

### `static/textures/`

Каталог текстур

#### `static/textures/spritesheets/`

Каталог таблиц спрайтов для анимированных спрайтов

## `tools`

Пакет модулей упрощающих разработку.

### `tools.load_tools`

Функции работающие с файлами.

**`tools.load_tools.loadJson()`** - возвращает словарь соответствующий указанному json-объекту

```python
def loadJson(path: str) -> dict
```

**`tools.load_tools.getSpriteSheet()`** - возвращает словарь содержащий кадры всех анимаций спрайта
    
Принимает:
- `path` - путь к изображению таблицы спрайтов
- `size` - размер одного кадра
- `scale` - множитель размера кадров

Возвращает:
- `spritesheet` - итоговый словарь с кадрами

```python
def getSpriteSheet(
    path: str,
    size: int = 16,
    scale: float = 1
) -> dict[str, Any]
```

### `tools.math_tools`

**`tools.math_tools.sign()`** - определяет знак числа.

Параметры:
- `n` - число для которого определяется знак

Возвращает:
- -1, `n` < 0
- 0, `n` = 0
- 1, `n` > 0

```python
def sign(n: float) -> float
```

**`tools.math_tools.nextIterible()`** - перебирает элементы итерируемого объекта с заданной скоростью.

Параметры:
- `iterible` - итерируемый объект, для которого проверяется должен ли смениться элемент
- `index` - текущий `float` индекс
- `time` - время с предыдущего вызова
- `speed` - скорость (элементы/секунду) с которой сменяются элементы итерируемого объекта

Возвращает:
- текущий элемент и текущий `float` индекс

```python
def nextIterible(
    iterible: Any,
    index: float,
    time: int,
    speed: int
) -> Any
```

**`tools.math_tools.absMax()`** - находит максимальное по модулю число из набора.

Параметры:
- `nums` - набор чисел

Возвращает:
- модуль максимального по модулю числа из набора

```python
def absMax(nums: Any) -> Any
```

**`tools.math_tools.signFilter()`** - пропускает число, если оно соответсвтует условию.

Параметры:
- `n` - число к которому применяется фильтр
- `mode` - режим работы фильтра:
    - 0 - пропускает число без фильтрации
    - 1 - пропускает только положительное число
    - 2 - пропускает только отрицательное число
    - другое - не пропускает никакое число

Возвращает:
- `n` - принятое число, если оно соответсвтует условию
- `0` - если оно не соответсвтует условию

```python
def signFilter(
    n: float,
    mode: int
) -> float
```

**`tools.math_tools.rectInArea()`** - находит часть `rect`, которая накладывается на `area`, и отступ `offset` необходимый для обрезания текстуры объекта,
которому принадлежит `rect`.

Принимает:
- `rect` - прямоугольник (pygame.Rect) для которого находится область наложения на `area`
- `area` - прямоугольник (pygame.Rect) используемый для нахождения части `rect`

Возвращает:
- `rect` -  область наложения параметра `rect` на `area`

```python
def rectInArea(
    rect: Any,
    area: Any
) -> tuple[Any, list[int]]
```